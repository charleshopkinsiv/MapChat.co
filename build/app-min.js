let chatRoom=document.getElementById("chat-room"),messageButton=document.getElementById("message-button"),openChat=e=>{chatRoom.style.display="block",infoBtn.style.display="none",backdrop.style.display="block",backdrop.setAttribute("onclick","closeChat()"),messageButton.setAttribute("onclick","sendMessage("+e+")"),loadChats(e)},closeChat=()=>{chatRoom.style.display="none",infoBtn.style.display="block",backdrop.style.display="none"},loadChats=e=>{let o="";fetch(urlRoot+"/app/loadChats.php?room="+e).then(e=>e.json()).then(e=>{console.log("Hello");for(var t=0;t<e.length;t++){let n=e[t];o+=`<div class="chat-message"><div class="message-author">${n[0]}</div><div class="message-text">${n[1]}</div></div>`}}).then(()=>{document.getElementById("chat-messages").innerHTML=o})},sendMessage=e=>{let o=document.getElementById("chat-textbox").value;fetch(urlRoot+"/app/sendMessage.php?message="+o+"&room="+e).then(()=>{document.getElementById("chat-textbox").value="",loadChats(e)}).catch(e=>console.error("Error:",e))};const urlRoot="http://localhost/dev/map-chat/build";let info=document.getElementById("info"),infoBtn=document.getElementById("info-button"),backdrop=document.getElementById("backdrop");setTimeout(()=>{showInfo()},1e3);let showInfo=()=>{info.style.display="block",infoBtn.style.display="none",backdrop.style.display="block",backdrop.setAttribute("onclick","closeInfo()")},closeInfo=()=>{info.style.display="none",infoBtn.style.display="block",backdrop.style.display="none"},login=()=>{let e=document.getElementById("log-email").value,o=document.getElementById("log-pw").value;if(""==e)return void(document.getElementById("login-error").innerHTML="Enter your Email!");if(""==o)return void(document.getElementById("login-error").innerHTML="Enter your Password!");let t={email:e,password:o};t=JSON.stringify(t);let n=new FormData;n.append("data",t),fetch(urlRoot+"/app/login.php",{method:"POST",mode:"cors",body:n}).then(e=>e.text().then(e=>{"Success"==e?window.location.href=window.location.pathname+window.location.search+window.location.hash:document.getElementById("login-error").innerHTML="Login Info is Incorrect!"})).catch(e=>console.error("Error:",e))},logout=()=>{fetch(urlRoot+"/app/logout.php").then(()=>window.location.href=window.location.pathname+window.location.search+window.location.hash).catch(e=>console.error("Error:",e))};var map;function initMap(){(map=new google.maps.Map(document.getElementById("map"),{center:{lat:34.274646,lng:-119.2290316},zoom:8,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1})).addListener("click",e=>{(function(e){for(var o=e+"=",t=decodeURIComponent(document.cookie).split(";"),n=0;n<t.length;n++){for(var r=t[n];" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(o))return r.substring(o.length,r.length)}return""})("user")&&fetch(urlRoot+"/app/checkUserRoom.php").then(e=>e.text()).then(o=>{1!=o?confirm("Do you want to create a new chat room?")&&fetch(urlRoot+"/app/addUserChat.php?location="+e.latLng).then(e=>e.text()).then(o=>{console.log(o),placeMarkerAndPanTo(e.latLng,map)}).catch(e=>console.error("Error:",e)):confirm("Do you want to delete you old chat room to create a new one?")&&fetch(urlRoot+"/app/removeUserRoom.php").then(e=>e.text()).then(o=>{console.log(o),fetch(urlRoot+"/app/addUserChat.php?location="+e.latLng).then(e=>e.text()).then(e=>{window.location.href=window.location.pathname+window.location.search+window.location.hash}).catch(e=>console.error("Error:",e))})}).catch(e=>console.error("Error:",e))}),setMarkers(map)}function setMarkers(e){fetch(urlRoot+"/app/getChatRooms.php").then(e=>e.json()).then(o=>{console.log("test");for(var t=0;t<o.length;t++){var n=o[t];let l=n[0].replace("(","").replace(")","").split(", "),a=Number(l[0]),s=Number(l[1]);console.log(a+", "+s);var r=new google.maps.Marker({position:{lat:a,lng:s},map:e,title:n[1],icon:"images/speach-bubble.png"});r.addListener("click",e=>{let o=r.getTitle();openChat(o)})}})}let signup=()=>{let e=document.getElementById("signup-email").value;if(""==e)return void(document.getElementById("signup-error").innerHTML="Enter Your Email!");let o=document.getElementById("signup-username").value;if(""==o)return void(document.getElementById("signup-error").innerHTML="Enter Your Username!");let t=document.getElementById("signup-pw").value;if(""==t)return void(document.getElementById("signup-error").innerHTML="Enter Your Password!");let n={email:e,username:o,password:t};n=JSON.stringify(n);let r=new FormData;r.append("data",n),fetch(urlRoot+"/app/signup.php",{method:"POST",mode:"cors",body:r}).then(e=>e.text().then(e=>{"success"==e||(document.getElementById("signup-error").innerHTML=e)})).catch(e=>console.error("Error:",e))};